"use strict";(()=>{var e={};e.id=944,e.ids=[944],e.modules={3524:e=>{e.exports=require("@prisma/client")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9991:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>I,originalPathname:()=>v,patchFetch:()=>P,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>m,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>g});var a={};r.r(a),r.d(a,{GET:()=>p,POST:()=>k});var o=r(5419),i=r(9108),n=r(9678),s=r(8070),y=r(7033);let d=new(r(1833)).Unkey({rootKey:process.env.UNKEY_ROOT_KEY});async function u(e,t="free"){let r={free:{limit:100,window:"1d"},pro:{limit:1e4,window:"1d"},enterprise:{limit:1e5,window:"1d"}},{result:a,error:o}=await d.keys.create({apiId:process.env.UNKEY_API_ID,ownerId:e,expires:"free"===t?void 0:Date.now()+2592e6,ratelimit:{type:"fast",limit:r[t].limit,window:r[t].window},meta:{plan:t,userId:e}});if(o)throw Error(`Failed to create API key: ${o.message}`);return a}async function c(e){let{error:t}=await d.keys.delete({keyId:e});if(t)throw Error(`Failed to revoke API key: ${t.message}`);return!0}async function l(e){let{result:t,error:r}=await d.keys.get({keyId:e});if(r)throw Error(`Failed to get API key: ${r.message}`);return t}async function k(e){try{let{userId:t,plan:r="free"}=await e.json();if(!t)return s.Z.json({error:"Missing userId"},{status:400});let a=await y._.apiUser.findUnique({where:{clerkUserId:t}});a?.unkeyKeyId&&await c(a.unkeyKeyId);let o=await u(t,r);return await y._.apiUser.upsert({where:{clerkUserId:t},update:{unkeyKeyId:o.keyId,unkeyKey:o.key},create:{clerkUserId:t,email:a?.email||"",unkeyKeyId:o.keyId,unkeyKey:o.key}}),s.Z.json({keyId:o.keyId,key:o.key,plan:r})}catch(e){return console.error("Error creating API key:",e),s.Z.json({error:"Failed to create API key"},{status:500})}}async function p(e){try{let t=e.headers.get("x-user-id");if(!t)return s.Z.json({error:"Unauthorized"},{status:401});let r=await y._.apiUser.findUnique({where:{clerkUserId:t}});if(!r||!r.unkeyKeyId)return s.Z.json({error:"No API key found"},{status:404});let a=await l(r.unkeyKeyId);return s.Z.json({keyId:r.unkeyKeyId,credits:r.credits,usage:{total:a?.usage||0,remaining:Math.max(0,(r.credits||1e3)-(a?.usage||0)),limit:r.credits||1e3},plan:a?.meta?.plan||"free",createdAt:r.createdAt})}catch(e){return console.error("Error fetching API key:",e),s.Z.json({error:"Failed to fetch API key"},{status:500})}}let h=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/keys/route",pathname:"/api/keys",filename:"route",bundlePath:"app/api/keys/route"},resolvedPagePath:"c:\\Users\\HP\\Downloads\\modelgecko\\app\\api\\keys\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:w,serverHooks:m,headerHooks:I,staticGenerationBailout:g}=h,v="/api/keys/route";function P(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:w})}},7033:(e,t,r)=>{r.d(t,{_:()=>o});var a=r(3524);let o=globalThis.prisma??new a.PrismaClient({log:["error"]})},1833:e=>{var t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,o=Object.prototype.hasOwnProperty,i={};((e,r)=>{for(var a in r)t(e,a,{get:r[a],enumerable:!0})})(i,{Unkey:()=>n}),e.exports=((e,i,n,s)=>{if(i&&"object"==typeof i||"function"==typeof i)for(let n of a(i))o.call(e,n)||void 0===n||t(e,n,{get:()=>i[n],enumerable:!(s=r(i,n))||s.enumerable});return e})(t({},"__esModule",{value:!0}),i);var n=class{constructor(e){if(this.baseUrl=e.baseUrl??"https://api.unkey.dev",!e.token)throw Error("Unkey token must not be empty");this.token=e.token}async fetch(e){let t=`${this.baseUrl}/${e.path.join("/")}`,r=await fetch(t,{method:e.method,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify(e.body)});if(!r.ok)throw Error(await r.text());return await r.json()}get keys(){return{create:async e=>await this.fetch({path:["v1","keys"],method:"POST",body:e}),update:async e=>await this.fetch({path:["v1","keys",e.keyId],method:"PUT",body:e}),verify:async e=>await this.fetch({path:["v1","keys","verify"],method:"POST",body:e}),revoke:async e=>{await this.fetch({path:["v1","keys",e.keyId],method:"DELETE"})}}}get _internal(){return{createRootKey:async e=>await this.fetch({path:["v1","internal","rootkeys"],method:"POST",body:e})}}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,206],()=>r(9991));module.exports=a})();