"use strict";(()=>{var e={};e.id=944,e.ids=[944],e.modules={3524:e=>{e.exports=require("@prisma/client")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},233:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>v,originalPathname:()=>g,patchFetch:()=>P,requestAsyncStorage:()=>f,routeModule:()=>k,serverHooks:()=>w,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>I});var a={};r.r(a),r.d(a,{GET:()=>h,POST:()=>p});var n=r(5419),i=r(9108),o=r(9678),s=r(8070),l=r(7033);let y=new(r(1833)).Unkey({token:process.env.UNKEY_ROOT_KEY});async function u(e,t="free"){let r={free:{limit:100,refillRate:100,refillInterval:86400},pro:{limit:1e4,refillRate:1e4,refillInterval:86400},enterprise:{limit:1e5,refillRate:1e5,refillInterval:86400}};return await y.keys.create({apiId:process.env.UNKEY_API_ID,ownerId:e,expires:"free"===t?void 0:Date.now()+2592e6,ratelimit:{type:"fast",limit:r[t].limit,refillRate:r[t].refillRate,refillInterval:r[t].refillInterval},meta:{plan:t,userId:e}})}async function c(e){let t=await fetch("https://api.unkey.dev/v1/keys.updateKey",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${process.env.UNKEY_ROOT_KEY}`},body:JSON.stringify({keyId:e,enabled:!1})});if(!t.ok){let e=await t.text();throw Error(`Failed to revoke API key: ${e}`)}return!0}async function d(e){let t=await fetch(`https://api.unkey.dev/v1/keys.getKey?keyId=${encodeURIComponent(e)}`,{method:"GET",headers:{Authorization:`Bearer ${process.env.UNKEY_ROOT_KEY}`}});if(!t.ok){let e=await t.text();throw Error(`Failed to get API key: ${e}`)}return await t.json()}async function p(e){try{let{userId:t,plan:r="free"}=await e.json();if(!t)return s.Z.json({error:"Missing userId"},{status:400});let a=await l._.apiUser.findUnique({where:{clerkUserId:t}});a?.unkeyKeyId&&await c(a.unkeyKeyId);let n=await u(t,r);return await l._.apiUser.upsert({where:{clerkUserId:t},update:{unkeyKeyId:n.keyId,unkeyKey:n.key},create:{clerkUserId:t,email:a?.email||"",unkeyKeyId:n.keyId,unkeyKey:n.key}}),s.Z.json({keyId:n.keyId,key:n.key,plan:r})}catch(e){return console.error("Error creating API key:",e),s.Z.json({error:"Failed to create API key"},{status:500})}}async function h(e){try{let t=e.headers.get("x-user-id");if(!t)return s.Z.json({error:"Unauthorized"},{status:401});let r=await l._.apiUser.findUnique({where:{clerkUserId:t}});if(!r||!r.unkeyKeyId)return s.Z.json({error:"No API key found"},{status:404});let a=await d(r.unkeyKeyId);return s.Z.json({keyId:r.unkeyKeyId,credits:r.credits,usage:{total:a?.usage||0,remaining:Math.max(0,(r.credits||1e3)-(a?.usage||0)),limit:r.credits||1e3},plan:a?.meta?.plan||"free",createdAt:r.createdAt})}catch(e){return console.error("Error fetching API key:",e),s.Z.json({error:"Failed to fetch API key"},{status:500})}}let k=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/keys/route",pathname:"/api/keys",filename:"route",bundlePath:"app/api/keys/route"},resolvedPagePath:"/home/engine/project/app/api/keys/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:m,serverHooks:w,headerHooks:v,staticGenerationBailout:I}=k,g="/api/keys/route";function P(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:m})}},7033:(e,t,r)=>{r.d(t,{_:()=>s});var a=r(3524);let n=globalThis,i=null,o=()=>new a.PrismaClient({log:["error"]}),s=new Proxy({},{get(e,t){if(!i)try{i=n.prisma??o()}catch(e){return console.warn("Failed to initialize Prisma client:",e),async()=>(console.error("Database not available"),[])}return"model"===t||"apiUser"===t||"usageLog"===t||"pricingPlan"===t?new Proxy({},{get:(e,r)=>async(...e)=>{try{return await i[t][r](...e)}catch(e){if(console.error(`Database error on ${String(t)}.${String(r)}:`,e?.message||e),"findMany"===r||"findFirst"===r)return[];if("count"===r)return 0;if("create"===r||"update"===r||"delete"===r)throw e;return null}}}):i?.[t]}})},1833:e=>{var t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,i={};((e,r)=>{for(var a in r)t(e,a,{get:r[a],enumerable:!0})})(i,{Unkey:()=>o}),e.exports=((e,i,o,s)=>{if(i&&"object"==typeof i||"function"==typeof i)for(let o of a(i))n.call(e,o)||void 0===o||t(e,o,{get:()=>i[o],enumerable:!(s=r(i,o))||s.enumerable});return e})(t({},"__esModule",{value:!0}),i);var o=class{constructor(e){if(this.baseUrl=e.baseUrl??"https://api.unkey.dev",!e.token)throw Error("Unkey token must not be empty");this.token=e.token}async fetch(e){let t=`${this.baseUrl}/${e.path.join("/")}`,r=await fetch(t,{method:e.method,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify(e.body)});if(!r.ok)throw Error(await r.text());return await r.json()}get keys(){return{create:async e=>await this.fetch({path:["v1","keys"],method:"POST",body:e}),update:async e=>await this.fetch({path:["v1","keys",e.keyId],method:"PUT",body:e}),verify:async e=>await this.fetch({path:["v1","keys","verify"],method:"POST",body:e}),revoke:async e=>{await this.fetch({path:["v1","keys",e.keyId],method:"DELETE"})}}}get _internal(){return{createRootKey:async e=>await this.fetch({path:["v1","internal","rootkeys"],method:"POST",body:e})}}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,206],()=>r(233));module.exports=a})();