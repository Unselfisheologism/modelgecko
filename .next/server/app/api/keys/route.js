"use strict";(()=>{var e={};e.id=944,e.ids=[944],e.modules={3524:e=>{e.exports=require("@prisma/client")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9991:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>w,originalPathname:()=>g,patchFetch:()=>P,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>v,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>I});var a={};r.r(a),r.d(a,{GET:()=>k,POST:()=>p});var i=r(5419),o=r(9108),n=r(9678),s=r(8070),l=r(7033);let y=new(r(1833)).Unkey({token:process.env.UNKEY_ROOT_KEY});async function d(e,t="free"){let r={free:{limit:100,refillRate:100,refillInterval:86400},pro:{limit:1e4,refillRate:1e4,refillInterval:86400},enterprise:{limit:1e5,refillRate:1e5,refillInterval:86400}};return await y.keys.create({apiId:process.env.UNKEY_API_ID,ownerId:e,expires:"free"===t?void 0:Date.now()+2592e6,ratelimit:{type:"fast",limit:r[t].limit,refillRate:r[t].refillRate,refillInterval:r[t].refillInterval},meta:{plan:t,userId:e}})}async function u(e){let t=await fetch("https://api.unkey.dev/v1/keys.updateKey",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${process.env.UNKEY_ROOT_KEY}`},body:JSON.stringify({keyId:e,enabled:!1})});if(!t.ok){let e=await t.text();throw Error(`Failed to revoke API key: ${e}`)}return!0}async function c(e){let t=await fetch(`https://api.unkey.dev/v1/keys.getKey?keyId=${encodeURIComponent(e)}`,{method:"GET",headers:{Authorization:`Bearer ${process.env.UNKEY_ROOT_KEY}`}});if(!t.ok){let e=await t.text();throw Error(`Failed to get API key: ${e}`)}return await t.json()}async function p(e){try{let{userId:t,plan:r="free"}=await e.json();if(!t)return s.Z.json({error:"Missing userId"},{status:400});let a=await l._.apiUser.findUnique({where:{clerkUserId:t}});a?.unkeyKeyId&&await u(a.unkeyKeyId);let i=await d(t,r);return await l._.apiUser.upsert({where:{clerkUserId:t},update:{unkeyKeyId:i.keyId,unkeyKey:i.key},create:{clerkUserId:t,email:a?.email||"",unkeyKeyId:i.keyId,unkeyKey:i.key}}),s.Z.json({keyId:i.keyId,key:i.key,plan:r})}catch(e){return console.error("Error creating API key:",e),s.Z.json({error:"Failed to create API key"},{status:500})}}async function k(e){try{let t=e.headers.get("x-user-id");if(!t)return s.Z.json({error:"Unauthorized"},{status:401});let r=await l._.apiUser.findUnique({where:{clerkUserId:t}});if(!r||!r.unkeyKeyId)return s.Z.json({error:"No API key found"},{status:404});let a=await c(r.unkeyKeyId);return s.Z.json({keyId:r.unkeyKeyId,credits:r.credits,usage:{total:a?.usage||0,remaining:Math.max(0,(r.credits||1e3)-(a?.usage||0)),limit:r.credits||1e3},plan:a?.meta?.plan||"free",createdAt:r.createdAt})}catch(e){return console.error("Error fetching API key:",e),s.Z.json({error:"Failed to fetch API key"},{status:500})}}let h=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/keys/route",pathname:"/api/keys",filename:"route",bundlePath:"app/api/keys/route"},resolvedPagePath:"c:\\Users\\HP\\Downloads\\modelgecko\\app\\api\\keys\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:m,serverHooks:v,headerHooks:w,staticGenerationBailout:I}=h,g="/api/keys/route";function P(){return(0,n.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:m})}},7033:(e,t,r)=>{r.d(t,{_:()=>i});var a=r(3524);let i=globalThis.prisma??new a.PrismaClient({log:["error"]})},1833:e=>{var t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,o={};((e,r)=>{for(var a in r)t(e,a,{get:r[a],enumerable:!0})})(o,{Unkey:()=>n}),e.exports=((e,o,n,s)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let n of a(o))i.call(e,n)||void 0===n||t(e,n,{get:()=>o[n],enumerable:!(s=r(o,n))||s.enumerable});return e})(t({},"__esModule",{value:!0}),o);var n=class{constructor(e){if(this.baseUrl=e.baseUrl??"https://api.unkey.dev",!e.token)throw Error("Unkey token must not be empty");this.token=e.token}async fetch(e){let t=`${this.baseUrl}/${e.path.join("/")}`,r=await fetch(t,{method:e.method,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify(e.body)});if(!r.ok)throw Error(await r.text());return await r.json()}get keys(){return{create:async e=>await this.fetch({path:["v1","keys"],method:"POST",body:e}),update:async e=>await this.fetch({path:["v1","keys",e.keyId],method:"PUT",body:e}),verify:async e=>await this.fetch({path:["v1","keys","verify"],method:"POST",body:e}),revoke:async e=>{await this.fetch({path:["v1","keys",e.keyId],method:"DELETE"})}}}get _internal(){return{createRootKey:async e=>await this.fetch({path:["v1","internal","rootkeys"],method:"POST",body:e})}}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,206],()=>r(9991));module.exports=a})();